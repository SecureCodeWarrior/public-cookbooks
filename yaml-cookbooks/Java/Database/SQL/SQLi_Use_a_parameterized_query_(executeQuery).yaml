id: scw:sqli:prepared-statement
version: 8
metadata:
  name: sql injection - use a parameterized query
  shortDescription: execute query with untrusted inputs is vulnerable to SQL Injection
  level: error
  scwCategory: ""
  enabled: true
  comment: Copy of other recipe?
search:
  methodcall:
    args:
      1:
        containsUntrustedInput: true
        type: java.lang.String
    name: executeQuery
    type: java.sql.Statement
availableFixes:
- name: convert to a prepared statement
  actions:
  - parameterize:
      placeholderFormat: '?'
      extractUntrustedInput:
        methodsOnObject:
          methods:
          - methodName: setString
            args:
              "1": '{{{ index }}}'
              "2": '{{{ . }}}'
          target:
            subject:
              insertBefore: true
  - changeTypeOfCallObject:
      rewriteLastAssignment: '{{{ qualifier }}}.prepareStatement({{{ markedElement.arguments.0}}}{{#arguments}},
        {{{.}}}{{/arguments}})'
      type: java.sql.PreparedStatement
  - modifyArguments:
      remove:
      - 1
